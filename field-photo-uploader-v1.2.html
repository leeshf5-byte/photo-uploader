<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜„ì¥ ì‚¬ì§„ ì—…ë¡œë”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 40px);
        }
        
        .login-box {
            max-width: 400px;
            width: 100%;
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .login-box h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .login-box h2 {
            font-size: 20px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .version {
            font-size: 14px;
            color: #999;
            font-weight: 400;
            margin-left: 5px;
        }
        
        .login-subtitle {
            color: #667eea;
            margin-bottom: 35px;
            font-size: 14px;
            font-weight: 600;
            padding: 10px;
            background: #f0f0ff;
            border-radius: 8px;
        }
        
        .login-button {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }
        
        .login-button:hover {
            background: #5568d3;
        }
        
        .login-button:active {
            transform: scale(0.98);
        }
        
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 20px 0;
        }
        
        .key-button {
            padding: 12px;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
        }
        
        .key-button:hover {
            background: #e0e0e0;
            transform: scale(1.05);
        }
        
        .key-button:active {
            background: #d0d0d0;
            transform: scale(0.95);
        }
        
        .key-button.clear {
            background: #ff9500;
            color: white;
            border-color: #ff9500;
            font-size: 14px;
        }
        
        .key-button.clear:hover {
            background: #e68600;
        }
        
        .key-button.delete {
            background: #ff3b30;
            color: white;
            border-color: #ff3b30;
            font-size: 18px;
        }
        
        .key-button.delete:hover {
            background: #e02020;
        }
        
        .error-message {
            color: #ff3b30;
            font-size: 14px;
            margin-top: 15px;
            min-height: 20px;
            font-weight: 500;
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 12px 15px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        
        .user-info span {
            font-weight: 600;
            color: #333;
        }
        
        .logout-button {
            padding: 8px 16px;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .logout-button:hover {
            background: #e02020;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 20px;
            line-height: 1.4;
        }
        
        h1 .version {
            font-size: 13px;
            color: #999;
            font-weight: 400;
        }
        
        .subtitle {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 15px;
            font-weight: 600;
            border-left: 4px solid #667eea;
            padding-left: 12px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        select, input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: white;
        }
        
        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .custom-input {
            margin-top: 10px;
            display: none;
        }
        
        .custom-input.show {
            display: block;
        }
        
        .camera-section {
            margin: 30px 0;
            text-align: center;
        }
        
        .camera-button {
            width: 100%;
            padding: 15px;
            background: #FF3B30;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .camera-button:hover {
            background: #E02020;
        }
        
        .camera-button:active {
            transform: scale(0.98);
        }
        
        .camera-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .gallery-button {
            width: 100%;
            padding: 15px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .gallery-button:hover {
            background: #0051D5;
        }
        
        .gallery-button:active {
            transform: scale(0.98);
        }
        
        .gallery-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .preview-section {
            margin-top: 20px;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-top: 15px;
        }
        
        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }
        
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .preview-item .remove-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preview-item .time-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px;
            font-size: 8px;
            text-align: center;
        }
        
        .upload-button {
            width: 100%;
            padding: 15px;
            background: #FF9500;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
        }
        
        .upload-button:hover {
            background: #E68600;
        }
        
        .upload-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .folder-preview {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
        }
        
        .folder-preview h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .folder-preview .folder-name {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }
        
        .success-message {
            background: #34c759;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        
        .success-message.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .photo-count {
            color: #667eea;
            font-weight: 600;
            margin-top: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h1>ğŸ“¸ (ì£¼)íƒ‘ì´ì•¤ì”¨</h1>
            <h2>í˜„ì¥ì‚¬ì§„ ì—…ë¡œë” <span class="version">V1.2</span></h2>
            <p class="login-subtitle">ë‹¹ì‹ ì˜ ì•ˆì „ì´ ìš°ë¦¬ ëª¨ë‘ì˜ ì•ˆì „ì…ë‹ˆë‹¤.</p>
            
            <div class="form-group">
                <label for="password">ğŸ”’ ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" readonly>
            </div>
            
            <div class="keypad">
                <button class="key-button" data-key="1">1</button>
                <button class="key-button" data-key="2">2</button>
                <button class="key-button" data-key="3">3</button>
                <button class="key-button" data-key="4">4</button>
                <button class="key-button" data-key="5">5</button>
                <button class="key-button" data-key="6">6</button>
                <button class="key-button" data-key="7">7</button>
                <button class="key-button" data-key="8">8</button>
                <button class="key-button" data-key="9">9</button>
                <button class="key-button clear" data-key="clear">ì§€ìš°ê¸°</button>
                <button class="key-button" data-key="0">0</button>
                <button class="key-button delete" data-key="delete">â†</button>
            </div>
            
            <button class="login-button" id="loginBtn">
                ë¡œê·¸ì¸
            </button>
            
            <div class="error-message" id="errorMessage"></div>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="user-info">
            <span>ğŸ”’ ë¡œê·¸ì¸ë¨</span>
            <button class="logout-button" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        
        <h1>ğŸ“¸ (ì£¼)íƒ‘ì´ì•¤ì”¨ í˜„ì¥ì‚¬ì§„ ì—…ë¡œë” <span class="version">V1.2</span></h1>
        <p class="subtitle">ë‹¹ì‹ ì˜ ì•ˆì „ì´ ìš°ë¦¬ ëª¨ë‘ì˜ ì•ˆì „ì…ë‹ˆë‹¤.</p>
        
        <div class="form-group">
            <label for="locationCategory">ğŸ“ ìœ„ì¹˜ ì¹´í…Œê³ ë¦¬</label>
            <select id="locationCategory">
                <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="underpass">ì§€í•˜ì°¨ë„</option>
                <option value="overpass">ìœ¡êµ</option>
                <option value="eco-overpass">ìƒíƒœìœ¡êµ</option>
                <option value="footbridge">ì¸ë„êµ</option>
                <option value="etc">ê¸°íƒ€</option>
            </select>
        </div>
        
        <div class="form-group" id="locationDetailGroup" style="display: none;">
            <label for="locationDetail">ğŸ“ ì„¸ë¶€ ìœ„ì¹˜</label>
            <select id="locationDetail">
                <option value="">ì„¸ë¶€ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
            <input type="text" id="customLocation" class="custom-input" placeholder="ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        
        <div class="form-group">
            <label for="workType">ğŸ”§ ì‘ì—… ìœ í˜•</label>
            <select id="workType">
                <option value="">ì‘ì—… ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="ì‹œì„¤ë¬¼ ì ê²€">ì‹œì„¤ë¬¼ ì ê²€</option>
                <option value="í™˜ê²½ì •ë¹„">í™˜ê²½ì •ë¹„</option>
                <option value="ì°¨ì„ í†µì œ">ì°¨ì„ í†µì œ</option>
                <option value="í˜„ì¥ë‹µì‚¬">í˜„ì¥ë‹µì‚¬</option>
                <option value="custom">ì§ì ‘ ì…ë ¥</option>
            </select>
            <input type="text" id="customWork" class="custom-input" placeholder="ì‘ì—… ìœ í˜•ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        
        <div class="folder-preview" id="folderPreview" style="display:none;">
            <h3>ğŸ“ ìƒì„±ë  í´ë”ëª…</h3>
            <div class="folder-name" id="folderName"></div>
        </div>
        
        <div class="camera-section">
            <button class="camera-button" id="cameraBtn" disabled>
                <span>ğŸ“¸</span>
                <span>ë°”ë¡œ ì°ì–´ ì˜¬ë¦¬ê¸°</span>
            </button>
            <input type="file" id="cameraInput" accept="image/*" capture="environment" multiple>
            
            <button class="gallery-button" id="galleryBtn" disabled>
                <span>ğŸ–¼ï¸</span>
                <span>ì•¨ë²”ì—ì„œ ì„ íƒí•˜ê¸°</span>
            </button>
            <input type="file" id="galleryInput" accept="image/*" multiple>
        </div>
        
        <div class="preview-section">
            <div class="photo-count" id="photoCount" style="display:none;"></div>
            <div class="preview-grid" id="previewGrid"></div>
        </div>
        
        <button class="upload-button" id="uploadBtn" disabled>
            ë“œë¼ì´ë¸Œì— ì—…ë¡œë“œí•˜ê¸°
        </button>
        
        <div class="success-message" id="successMessage">
            âœ… ì—…ë¡œë“œ ì™„ë£Œ! <span id="uploadedCount"></span>ì¥ì˜ ì‚¬ì§„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Google Drive API ì„¤ì •
        const CLIENT_ID = '664008371178-05g5feth04d5qnh9qejhqpjmvm8utcd1.apps.googleusercontent.com';
        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        
        let gapiInited = false;
        let gisInited = false;
        let tokenClient;
        let accessToken = null;
        
        // Google API ì´ˆê¸°í™”
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }
        
        async function initializeGapiClient() {
            try {
                await gapi.client.init({
                    discoveryDocs: DISCOVERY_DOCS,
                });
                gapiInited = true;
                console.log('GAPI ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (err) {
                console.error('GAPI ì´ˆê¸°í™” ì˜¤ë¥˜:', err);
            }
        }
        
        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', // ë‚˜ì¤‘ì— ì„¤ì •
            });
            gisInited = true;
            console.log('GIS ì´ˆê¸°í™” ì™„ë£Œ');
        }
        
        // Google ë¡œê·¸ì¸ ë° ê¶Œí•œ ìš”ì²­
        function handleAuthClick() {
            return new Promise((resolve, reject) => {
                tokenClient.callback = async (resp) => {
                    if (resp.error !== undefined) {
                        reject(resp);
                        return;
                    }
                    accessToken = gapi.client.getToken().access_token;
                    console.log('Google Drive ì¸ì¦ ì™„ë£Œ!');
                    resolve();
                };

                if (gapi.client.getToken() === null) {
                    tokenClient.requestAccessToken({prompt: 'consent'});
                } else {
                    tokenClient.requestAccessToken({prompt: ''});
                }
            });
        }
        
        // Google Driveì— í´ë” ìƒì„± ë˜ëŠ” ì°¾ê¸°
        async function findOrCreateFolder(folderName) {
            try {
                // í´ë” ê²€ìƒ‰
                const response = await gapi.client.drive.files.list({
                    q: `name='${folderName}' and mimeType='application/vnd.google-apps.folder' and trashed=false`,
                    fields: 'files(id, name)',
                });
                
                if (response.result.files && response.result.files.length > 0) {
                    // í´ë”ê°€ ì´ë¯¸ ìˆìœ¼ë©´ í•´ë‹¹ ID ë°˜í™˜
                    console.log('ê¸°ì¡´ í´ë” ì°¾ìŒ:', response.result.files[0].id);
                    return response.result.files[0].id;
                } else {
                    // í´ë” ìƒì„±
                    const folderMetadata = {
                        name: folderName,
                        mimeType: 'application/vnd.google-apps.folder'
                    };
                    
                    const folder = await gapi.client.drive.files.create({
                        resource: folderMetadata,
                        fields: 'id'
                    });
                    
                    console.log('ìƒˆ í´ë” ìƒì„±:', folder.result.id);
                    return folder.result.id;
                }
            } catch (err) {
                console.error('í´ë” ìƒì„±/ì°¾ê¸° ì˜¤ë¥˜:', err);
                throw err;
            }
        }
        
        // Google Driveì— íŒŒì¼ ì—…ë¡œë“œ
        async function uploadFileToFolder(file, fileName, folderId) {
            const metadata = {
                name: fileName,
                parents: [folderId]
            };
            
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', file);
            
            const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                body: form,
            });
            
            if (!response.ok) {
                throw new Error(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
            }
            
            return response.json();
        }
        
        // ì‹¤ì œ Google Drive ì—…ë¡œë“œ í•¨ìˆ˜
        async function uploadToGoogleDrive() {
            try {
                // í´ë”ëª… ê°€ì ¸ì˜¤ê¸°
                const folderNameText = folderName.textContent;
                console.log('ì—…ë¡œë“œ ì‹œì‘ - í´ë”:', folderNameText);
                
                // í´ë” ì°¾ê¸° ë˜ëŠ” ìƒì„±
                const folderId = await findOrCreateFolder(folderNameText);
                console.log('í´ë” ID:', folderId);
                
                // í˜„ì¬ ìœ„ì¹˜ì™€ ì‘ì—… ìœ í˜• ê°€ì ¸ì˜¤ê¸°
                let location = locationDetail.value;
                if (location === 'custom') {
                    location = customLocationInput.value.trim();
                }
                
                let workType = workTypeSelect.value;
                if (workType === 'custom') {
                    workType = customWorkInput.value.trim();
                }
                
                // ê° ì‚¬ì§„ ì—…ë¡œë“œ
                for (let i = 0; i < photos.length; i++) {
                    const photo = photos[i];
                    const hours = String(photo.time.getHours()).padStart(2, '0');
                    const minutes = String(photo.time.getMinutes()).padStart(2, '0');
                    const timeStr = `${hours}${minutes}`;
                    const fileNumber = String(i + 1).padStart(3, '0');
                    const fileName = `${location}_${workType}_${timeStr}_${fileNumber}.jpg`;
                    
                    console.log(`ì—…ë¡œë“œ ì¤‘ (${i + 1}/${photos.length}): ${fileName}`);
                    await uploadFileToFolder(photo.file, fileName, folderId);
                }
                
                console.log('ëª¨ë“  íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ!');
                
                // ì„±ê³µ ë©”ì‹œì§€
                uploadedCount.textContent = photos.length;
                successMessage.classList.add('show');
                
                // ì´ˆê¸°í™”
                setTimeout(function() {
                    photos = [];
                    renderPhotos();
                    uploadBtn.textContent = 'ë“œë¼ì´ë¸Œì— ì—…ë¡œë“œí•˜ê¸°';
                    uploadBtn.disabled = false;
                    
                    setTimeout(function() {
                        successMessage.classList.remove('show');
                    }, 3000);
                }, 1500);
                
            } catch (err) {
                console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', err);
                alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
                uploadBtn.textContent = 'ë“œë¼ì´ë¸Œì— ì—…ë¡œë“œí•˜ê¸°';
                uploadBtn.disabled = false;
            }
        }
        
        // ë©”ì¸ ë¹„ë°€ë²ˆí˜¸
        const MASTER_PASSWORD = '0353';
        
        const loginContainer = document.getElementById('loginContainer');
        const mainContainer = document.getElementById('mainContainer');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const passwordInput = document.getElementById('password');
        const errorMessage = document.getElementById('errorMessage');
        const keyButtons = document.querySelectorAll('.key-button');
        
        let passwordValue = '';
        
        // ìˆ«ì í‚¤íŒ¨ë“œ í´ë¦­ ì´ë²¤íŠ¸
        keyButtons.forEach(button => {
            button.addEventListener('click', function() {
                const key = this.getAttribute('data-key');
                
                if (key === 'clear') {
                    // ì „ì²´ ì§€ìš°ê¸°
                    passwordValue = '';
                    passwordInput.value = '';
                    errorMessage.textContent = '';
                } else if (key === 'delete') {
                    // í•œ ê¸€ì ì§€ìš°ê¸°
                    passwordValue = passwordValue.slice(0, -1);
                    passwordInput.value = 'â€¢'.repeat(passwordValue.length);
                    errorMessage.textContent = '';
                } else {
                    // ìˆ«ì ì…ë ¥
                    if (passwordValue.length < 10) {  // ìµœëŒ€ 10ìë¦¬
                        passwordValue += key;
                        passwordInput.value = 'â€¢'.repeat(passwordValue.length);
                        errorMessage.textContent = '';
                    }
                }
            });
        });
        
        // ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
        loginBtn.addEventListener('click', function() {
            if (!passwordValue) {
                errorMessage.textContent = 'âš ï¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
                return;
            }
            
            if (passwordValue === MASTER_PASSWORD) {
                // ë¡œê·¸ì¸ ì„±ê³µ
                loginContainer.style.display = 'none';
                mainContainer.style.display = 'block';
                errorMessage.textContent = '';
                passwordValue = '';
                passwordInput.value = '';
            } else {
                // ë¡œê·¸ì¸ ì‹¤íŒ¨
                errorMessage.textContent = 'âš ï¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤';
                passwordValue = '';
                passwordInput.value = '';
            }
        });
        
        // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­
        logoutBtn.addEventListener('click', function() {
            passwordValue = '';
            passwordInput.value = '';
            loginContainer.style.display = 'flex';
            mainContainer.style.display = 'none';
            
            // ë°ì´í„° ì´ˆê¸°í™”
            photos = [];
            renderPhotos();
            locationCategory.value = '';
            locationDetail.value = '';
            locationDetailGroup.style.display = 'none';
            workTypeSelect.value = '';
            customLocationInput.value = '';
            customWorkInput.value = '';
            customLocationInput.classList.remove('show');
            customWorkInput.classList.remove('show');
            folderPreview.style.display = 'none';
            cameraBtn.disabled = true;
            galleryBtn.disabled = true;
            uploadBtn.disabled = true;
        });
        
        const locationCategory = document.getElementById('locationCategory');
        const locationDetailGroup = document.getElementById('locationDetailGroup');
        const locationDetail = document.getElementById('locationDetail');
        const customLocationInput = document.getElementById('customLocation');
        const workTypeSelect = document.getElementById('workType');
        const customWorkInput = document.getElementById('customWork');
        const folderPreview = document.getElementById('folderPreview');
        const folderName = document.getElementById('folderName');
        const cameraBtn = document.getElementById('cameraBtn');
        const galleryBtn = document.getElementById('galleryBtn');
        const cameraInput = document.getElementById('cameraInput');
        const galleryInput = document.getElementById('galleryInput');
        const previewGrid = document.getElementById('previewGrid');
        const photoCount = document.getElementById('photoCount');
        const uploadBtn = document.getElementById('uploadBtn');
        const successMessage = document.getElementById('successMessage');
        const uploadedCount = document.getElementById('uploadedCount');
        
        let photos = [];
        
        // ìœ„ì¹˜ ë°ì´í„°
        const locationData = {
            'underpass': [
                'í•œê¸¸ ì§€í•˜ì°¨ë„',
                'í•œë¹› ì§€í•˜ì°¨ë„',
                'ì™€ë™ ì§€í•˜ì°¨ë„',
                'íƒ‘ê³¨ ì§€í•˜ì°¨ë„',
                'ì‹¬í•™ì‚° ì§€í•˜ì°¨ë„',
                'ì±…í–¥ê¸° ì§€í•˜ì°¨ë„',
                'ì‚°ë‚´ ì§€í•˜ì°¨ë„',
                'êµí•˜ ì§€í•˜ì°¨ë„',
                'gtxì¤‘ì•™ ì§€í•˜ì°¨ë„',
                'ê°€ì˜¨ ì§€í•˜ì°¨ë„'
            ],
            'overpass': [
                'ì˜¤ì†” ìœ¡êµ',
                'ì˜¤ë¦„ ìœ¡êµ',
                'í•œë¹› ìœ¡êµ',
                'í•œë§ˆë£¨ ìœ¡êµ',
                'ì§ší’€ ìœ¡êµ',
                'êµí•˜ ìœ¡êµ',
                'êµí•˜ì¤‘ì•™ê³µì› ìœ¡êµ',
                'ë™íŒ¨ ìœ¡êµ',
                'í•œìš¸ ìœ¡êµ',
                'í•´ì†” ìœ¡êµ'
            ],
            'eco-overpass': [
                'ì§ì ‘ ì…ë ¥'
            ],
            'footbridge': [
                'ì§ì ‘ ì…ë ¥'
            ],
            'etc': [
                'ì²œì •êµ¬ë¡œ',
                'ë™íŒ¨1êµ í•˜ë¶€ ì˜¹ë²½',
                'ì§ì ‘ ì…ë ¥'
            ]
        };
        
        // ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ
        locationCategory.addEventListener('change', function() {
            const category = this.value;
            
            if (category) {
                locationDetailGroup.style.display = 'block';
                locationDetail.innerHTML = '<option value="">ì„¸ë¶€ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                
                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ìœ„ì¹˜ ëª©ë¡ ì¶”ê°€
                locationData[category].forEach(loc => {
                    const option = document.createElement('option');
                    if (loc === 'ì§ì ‘ ì…ë ¥') {
                        option.value = 'custom';
                        option.textContent = loc;
                    } else {
                        option.value = loc;
                        option.textContent = loc;
                    }
                    locationDetail.appendChild(option);
                });
                
                locationDetail.value = '';
                customLocationInput.classList.remove('show');
                customLocationInput.value = '';
            } else {
                locationDetailGroup.style.display = 'none';
                locationDetail.value = '';
                customLocationInput.classList.remove('show');
                customLocationInput.value = '';
            }
            
            updateFolderName();
        });
        
        // ì„¸ë¶€ ìœ„ì¹˜ ì„ íƒ ì‹œ
        locationDetail.addEventListener('change', function() {
            if (this.value === 'custom') {
                customLocationInput.classList.add('show');
                customLocationInput.focus();
            } else {
                customLocationInput.classList.remove('show');
                customLocationInput.value = '';
            }
            updateFolderName();
        });
        
        // ì»¤ìŠ¤í…€ ìœ„ì¹˜ ì…ë ¥ ì‹œ
        customLocationInput.addEventListener('input', updateFolderName);
        
        // ì‘ì—… ìœ í˜• ì„ íƒ ì‹œ
        workTypeSelect.addEventListener('change', function() {
            if (this.value === 'custom') {
                customWorkInput.classList.add('show');
                customWorkInput.focus();
            } else {
                customWorkInput.classList.remove('show');
                customWorkInput.value = '';
            }
            updateFolderName();
        });
        
        // ì»¤ìŠ¤í…€ ì‘ì—… ì…ë ¥ ì‹œ
        customWorkInput.addEventListener('input', updateFolderName);
        
        // í´ë”ëª… ì—…ë°ì´íŠ¸
        function updateFolderName() {
            let location = locationDetail.value;
            let workType = workTypeSelect.value;
            
            // ìœ„ì¹˜ ì»¤ìŠ¤í…€ ì…ë ¥ ì²˜ë¦¬
            if (location === 'custom') {
                location = customLocationInput.value.trim();
            }
            
            // ì‘ì—… ìœ í˜• ì»¤ìŠ¤í…€ ì…ë ¥ ì²˜ë¦¬
            if (workType === 'custom') {
                workType = customWorkInput.value.trim();
            }
            
            if (location && workType) {
                const today = new Date();
                const day = today.getDate();
                const folder = `${day}ì¼ ${location} ${workType}`;
                folderName.textContent = folder;
                folderPreview.style.display = 'block';
                cameraBtn.disabled = false;
                galleryBtn.disabled = false;
            } else {
                folderPreview.style.display = 'none';
                cameraBtn.disabled = true;
                galleryBtn.disabled = true;
            }
        }
        
        // ì¹´ë©”ë¼ ë²„íŠ¼ í´ë¦­ (ë°”ë¡œ ì°ì–´ ì˜¬ë¦¬ê¸°)
        cameraBtn.addEventListener('click', function() {
            cameraInput.click();
        });
        
        // ê°¤ëŸ¬ë¦¬ ë²„íŠ¼ í´ë¦­ (ì•¨ë²”ì—ì„œ ì„ íƒí•˜ê¸°)
        galleryBtn.addEventListener('click', function() {
            galleryInput.click();
        });
        
        // ì¹´ë©”ë¼ë¡œ ì‚¬ì§„ ì´¬ì˜
        cameraInput.addEventListener('change', function(e) {
            handlePhotoSelection(e.target.files);
            cameraInput.value = '';
        });
        
        // ê°¤ëŸ¬ë¦¬ì—ì„œ ì‚¬ì§„ ì„ íƒ
        galleryInput.addEventListener('change', function(e) {
            handlePhotoSelection(e.target.files);
            galleryInput.value = '';
        });
        
        // ì‚¬ì§„ ì„ íƒ ì²˜ë¦¬ (ê³µí†µ í•¨ìˆ˜)
        function handlePhotoSelection(files) {
            const fileArray = Array.from(files);
            
            fileArray.forEach(file => {
                const reader = new FileReader();
                const captureTime = new Date();
                
                reader.onload = function(event) {
                    const photoData = {
                        file: file,
                        dataUrl: event.target.result,
                        time: captureTime
                    };
                    photos.push(photoData);
                    renderPhotos();
                };
                
                reader.readAsDataURL(file);
            });
        }
        
        // ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§
        function renderPhotos() {
            previewGrid.innerHTML = '';
            
            if (photos.length > 0) {
                photoCount.style.display = 'block';
                photoCount.textContent = `ğŸ“· ${photos.length}ì¥ì˜ ì‚¬ì§„`;
                uploadBtn.disabled = false;
            } else {
                photoCount.style.display = 'none';
                uploadBtn.disabled = true;
            }
            
            // í˜„ì¬ ìœ„ì¹˜ì™€ ì‘ì—… ìœ í˜• ê°€ì ¸ì˜¤ê¸°
            let location = locationDetail.value;
            if (location === 'custom') {
                location = customLocationInput.value.trim();
            }
            
            let workType = workTypeSelect.value;
            if (workType === 'custom') {
                workType = customWorkInput.value.trim();
            }
            
            photos.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'preview-item';
                
                const img = document.createElement('img');
                img.src = photo.dataUrl;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = 'Ã—';
                removeBtn.onclick = function() {
                    photos.splice(index, 1);
                    renderPhotos();
                };
                
                const timeLabel = document.createElement('div');
                timeLabel.className = 'time-label';
                
                // ì‹œê°„ í¬ë§· (ì‹œë¶„)
                const hours = String(photo.time.getHours()).padStart(2, '0');
                const minutes = String(photo.time.getMinutes()).padStart(2, '0');
                const timeStr = `${hours}${minutes}`;
                
                // íŒŒì¼ëª…: ìœ„ì¹˜_ì‘ì—…ë‚´ìš©_ì‹œë¶„_001.jpg í˜•ì‹
                const fileNumber = String(index + 1).padStart(3, '0');
                const fileName = `${location}_${workType}_${timeStr}_${fileNumber}.jpg`;
                timeLabel.textContent = fileName;
                
                div.appendChild(img);
                div.appendChild(removeBtn);
                div.appendChild(timeLabel);
                previewGrid.appendChild(div);
            });
        }
        
        // ì—…ë¡œë“œ ë²„íŠ¼
        uploadBtn.addEventListener('click', async function() {
            if (photos.length === 0) return;
            
            // Google API ì´ˆê¸°í™” í™•ì¸
            if (!gapiInited || !gisInited) {
                alert('Google APIê°€ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'â³ ì—…ë¡œë”©ì¤‘... ìˆ˜ê³  ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤!';
            
            try {
                // Google Drive ì¸ì¦ ë° ì—…ë¡œë“œ
                await handleAuthClick();
                await uploadToGoogleDrive();
            } catch (err) {
                console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', err);
                alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (err.message || err));
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'ë“œë¼ì´ë¸Œì— ì—…ë¡œë“œí•˜ê¸°';
            }
        });
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
